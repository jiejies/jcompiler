# Tiger 编译器

这是一个用 Java 实现的 Tiger 语言编译器。

## 项目结构

```
src/
├── main/
│   ├── antlr4/         # ANTLR4 语法定义
│   │   └── org/tiger/
│   │       └── Tiger.g4
│   └── java/          # Java 源代码
│       └── org/tiger/
│           ├── ast/    # 抽象语法树
│           ├── cfg/    # 控制流图
│           ├── semantic/ # 语义分析
│           └── ...
└── test/             # 测试代码和资源
    ├── java/
    └── resources/    # 测试用例
```

## 已实现功能

### 1. 词法分析
- [x] 使用 ANTLR4 实现词法分析器
- [x] 支持关键字、标识符、运算符等词法单元
- [x] 提供词法单元位置信息（行号、列号）

### 2. 语法分析
- [x] 使用 ANTLR4 实现语法分析器
- [x] 支持类定义、方法定义、字段定义
- [x] 支持继承关系
- [x] 生成语法树

### 3. 语义分析
- [x] 符号表管理
- [x] 类型检查
- [x] 作用域分析
- [x] 错误报告

### 4. 中间代码生成
- [x] 类消除（去除面向对象特性）
  - [x] 字段重命名（添加类名前缀）
  - [x] 方法转换（添加 this 参数）
  - [x] 继承关系处理
- [x] 控制流图（CFG）生成
  - [x] 基本块创建
  - [x] CFG 数据结构
  - [x] AST 到 CFG 的转换
    - [x] 基本赋值语句
    - [x] 数组操作（创建、赋值、访问）
    - [x] 条件语句（if-else）
    - [ ] 循环语句（while）
    - [ ] 方法调用
- [ ] 三地址码生成

## 待实现功能

### 1. 中间代码生成（续）
- [ ] 循环语句的 CFG 转换
- [ ] 方法调用的 CFG 转换
- [ ] 三地址码生成

### 2. 中间代码优化
- [ ] 常量传播
- [ ] 死代码消除
- [ ] 循环优化

### 3. 目标代码生成
- [ ] 寄存器分配
- [ ] 指令选择
- [ ] 代码生成

## 如何运行

1. 编译项目：
```bash
mvn clean compile
```

2. 运行测试：
```bash
mvn test
```

## 测试用例

目前支持以下测试场景：
1. 简单继承：测试基本的类继承关系和方法重写
2. 多层继承：测试多层继承关系下的字段和方法处理
3. 语义错误检查：测试类型错误、未定义变量等场景
4. CFG 生成：
   - 基本赋值语句测试
   - 数组操作测试
   - 条件语句测试

## 开发进度

- [x] Lab 1: 词法分析和语法分析
- [x] Lab 2: 语义分析
- [ ] Lab 3: 中间代码生成
  - [x] Part A: CFG 数据结构
  - [x] Part B: 类消除
  - [x] Part C: AST 到 CFG 的基本转换
  - [ ] Part D: 完整 CFG 转换（循环和方法调用）
  - [ ] Part E: 三地址码生成
  - [ ] Part F: 程序分析和优化

## 下一步计划

1. 实现循环语句（while）的 CFG 转换
   - 创建循环头部块
   - 处理循环体
   - 正确连接循环的控制流
   
2. 实现方法调用的 CFG 转换
   - 处理参数传递
   - 创建调用和返回块
   - 连接调用者和被调用者的 CFG

3. 开始实现三地址码生成
   - 设计三地址码的数据结构
   - 从 CFG 生成三地址码
   - 实现基本的优化

## 依赖

- Java 8 或更高版本
- ANTLR 4.13.1
- Maven 3.x

## 构建要求

- Java 11 或更高版本
- Maven 3.6 或更高版本
- ANTLR 4.13.1

## Tiger语言特性

Tiger是一个简单的命令式语言，具有以下特性：

- 整数和字符串类型
- 变量声明
- 函数定义
- 数组和记录
- 循环和条件语句

## 开发计划

- [x] 项目基础结构
- [x] ANTLR4语法文件
- [x] AST节点定义
- [ ] 语义分析
- [ ] 类型检查
- [ ] 中间代码生成
- [ ] 目标代码生成 
